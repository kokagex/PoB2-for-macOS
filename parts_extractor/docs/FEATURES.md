# 5つの新機能 - 詳細説明書

高額部品抽出ツール v2.0.0 で追加された5つの便利な機能を詳しく説明します。

## 機能1: 略式型式での曖昧検索機能

### 概要
部品の「略式型式」という情報を使って、見つけたい部品を検索できます。完全一致ではなく、部分的に一致すれば検索結果に表示されます。

### 使用場面
- 「AZT」という型式を含む全ての部品を見つけたい
- 「GX90」という型式がある部品を探している
- 型式の一部だけを覚えている場合

### 操作方法

```
┌─────────────────────────────────────┐
│ 設定パネル                           │
├─────────────────────────────────────┤
│ スプレッドシートID: [............]   │
│ シート名: [ドロップダウン]            │
│ 最低金額（円）: [100000]             │
│                                      │
│ 略式型式で検索: [検索テキスト入力]    │  < これが新機能
│ ※部分一致で検索                      │
│                                      │
│ [上位N件のみ表示] [10] 件            │  < 別の新機能
├─────────────────────────────────────┤
│ [データ取得] [フィルタ適用] ...       │
└─────────────────────────────────────┘
```

### 具体例

**例1: 「AZT240」という型式を含む全ての部品を検索**
1. 「略式型式で検索」欄に「AZT240」と入力
2. 「フィルタ適用」ボタンをクリック
3. short_modelが「AZT240」を含む行のみ表示される

**例2: 「GX」で始まる型式を全て見つける**
1. 「略式型式で検索」欄に「GX」と入力
2. 「フィルタ適用」ボタンをクリック
3. 「GX90」「GX100」など、GXを含む全ての部品が表示される

### 検索のコツ
- **大文字と小文字を区別しない**: 「gx90」と「GX90」は同じ結果になります
- **空欄の場合**: 検索条件なしで全件表示（他のフィルタは適用）
- **複数条件を組み合わせ**: 金額フィルタと組み合わせて、「100,000円以上で型式が AZT を含む」という検索が可能

### 技術情報
- **検索対象**: `short_model` 列
- **検索方式**: 部分一致（contains）
- **大文字小文字区別**: しない
- **実装メソッド**: `data_analyzer.filter_by_short_model()`

---

## 機能2: 最低金額検索で10件取得機能

### 概要
高い金額の部品から順に、指定件数（デフォルトは10件）のみを取得できます。「上位10件の高額部品」を素早く確認する際に便利です。

### 使用場面
- 最も高い部品からトップ10を確認したい
- 全件ではなく上位N件だけ見たい
- 報告資料に「最高額の5部品」を載せたい

### 操作方法

```
┌─────────────────────────────────────┐
│ 設定パネル                           │
├─────────────────────────────────────┤
│ 最低金額（円）: [100000]             │
│                                      │
│ [X] 上位N件のみ表示   [10] 件        │  < チェックボックス
│                                      │
│ ※チェックを入れると、その件数だけ   │
│   表示されます。                    │
│ ※デフォルトは10件。1～1000まで変更  │
│   可能です。                        │
├─────────────────────────────────────┤
│ [フィルタ適用]                       │
└─────────────────────────────────────┘
```

### 具体例

**例1: 最高額の10部品を見る**
1. 最低金額を「100,000円」に設定
2. 「上位N件のみ表示」にチェックを入れる
3. 件数が「10」のままにする
4. 「フィルタ適用」をクリック
5. 最低金額100,000円以上で、最高額から順に10件のみ表示される

**例2: 最高額の5部品を見る**
1. 「上位N件のみ表示」にチェックを入れる
2. 件数を「5」に変更（スピンボックスで上下可）
3. 「フィルタ適用」をクリック
4. 最高額から5件のみ表示される

**例3: 全件を見る**
1. 「上位N件のみ表示」のチェックを外す
2. 「フィルタ適用」をクリック
3. 最低金額条件に合う全ての部品が表示される

### チェックボックスの動作
- **チェック OFF**: スピンボックスが無効（灰色）になり、全件表示
- **チェック ON**: スピンボックスが有効になり、指定件数だけ表示

### 便利なポイント
- 件数は 1～1000 の範囲で自由に変更可能
- 金額の高い順に自動的にソートされるので、すぐに高額部品が見つかります
- CSVエクスポート時も、表示されている件数だけがエクスポートされます

### 技術情報
- **デフォルト件数**: 10
- **指定可能範囲**: 1～1000
- **ソート順**: 金額降順（高い順）
- **実装メソッド**: `data_analyzer.filter_by_amount(limit=N)`

---

## 機能3: 列ヘッダークリックでのソート機能

### 概要
テーブルの列ヘッダー（部品管理番号、部品名、金額など）をクリックすると、その列を基準に並び替えができます。クリックする度に昇順/降順が切り替わります。

### 使用場面
- 部品管理番号の順に並び替えたい
- 金額の安い順に見たい
- 車名でグループ分けして見たい

### 操作方法

```
┌──────────────────────────────────────────────────┐
│ 抽出結果テーブル                                 │
├──────────────────────────────────────────────────┤
│ 部品管理番号 ▲  │  部品名      │  金額    │ ...  │
│ P001        │  ベアリング  │ 250000 │      │
│ P002        │  ギア       │ 180000 │      │
│ P003        │  ボルト     │ 50000  │      │
│                                               │
│ ▲ = 昇順ソート中（小→大）                       │
│ ▼ = 降順ソート中（大→小）                       │
└──────────────────────────────────────────────────┘

1. 「部品管理番号」列ヘッダーをクリック
   → 番号順（小→大）にソート、ヘッダーに▲表示

2. もう一度「部品管理番号」列ヘッダーをクリック
   → 降順（大→小）に切り替え、ヘッダーに▼表示

3. 「金額」列ヘッダーをクリック
   → ソート対象が「金額」に変更、昇順ソート
```

### 具体例

**例1: 部品番号の昇順でソート**
1. テーブルの「部品管理番号」列ヘッダーをクリック
2. 部品がP001, P002, P003...の順に並び替わる
3. ヘッダーに「▲」マークが表示される

**例2: 金額を高い順に見る**
1. テーブルの「金額」列ヘッダーをクリック
2. 金額が小さい順に並び替わる（最初は昇順）
3. もう一度「金額」列ヘッダーをクリック
4. 金額が大きい順に並び替わる（降順に切り替わり）
5. ヘッダーに「▼」マークが表示される

**例3: 車名ごとにグループ分けして見る**
1. 「車名」列ヘッダーをクリック
2. 車名でアルファベット順に並び替わる
3. 同じ車の部品が一緒に表示される

### ソートアイコンの意味
| アイコン | 意味 | 例 |
|---------|------|-----|
| ▲ | 昇順ソート | 小→大、A→Z、古→新 |
| ▼ | 降順ソート | 大→小、Z→A、新→古 |
| なし | ソートなし | 元の順序 |

### パフォーマンス
- 10,000件のデータでも**1秒以内**にソート完了
- 大量データでもスムーズに動作します

### 技術情報
- **ソート方式**: Pandas sort_values()
- **実装メソッド**: `_on_column_header_click()`
- **ソート状態管理**: `self.sort_column`, `self.sort_ascending`

---

## 機能4: ダブルクリックで詳細ポップアップ表示

### 概要
テーブルの行をダブルクリックすると、その行の全ての情報が見やすくポップアップウィンドウで表示されます。テーブルに表示しきれない情報も確認できます。

### 使用場面
- 1つの部品について、全ての情報を詳しく確認したい
- スプレッドシートにある全列の情報を見たい
- 部品の詳細情報を印刷したい

### 操作方法

```
┌──────────────────────────────────────────────┐
│ 抽出結果テーブル                             │
├──────────────────────────────────────────────┤
│ P001  │ ベアリング │ 250000 │ ...           │
│ P002  │ ギア      │ 180000 │ ...  ◄ ここをダブルクリック
│ P003  │ ボルト    │ 50000  │ ...           │
└──────────────────────────────────────────────┘
                          ▼

┌────────────────────────────────┐
│     部品詳細情報               │
├────────────────────────────────┤
│ [基本情報]                      │
│  部品管理番号: P002            │
│  部品名: 精密ギア               │
│  ﾈｯﾄ価格: ¥180,000            │
│                                │
│ [車両情報]                      │
│  車名: トヨタ マーク            │
│  略式型式: GX90                │
│  車体カラー名称: シルバー       │
│  年式: 2020                    │
│  エンジン型式: 1GFE             │
│                                │
│ [在庫・品質情報]                │
│  在庫ステータス: 在庫あり       │
│  品質区分: 新品                 │
│  保管場所: A棟2階               │
│                                │
│ [その他情報]                    │
│  部品コード: GR2-001            │
│  メーカー: トヨタ自動車         │
│  登録日: 2025-01-15            │
│                                │
│                 [閉じる]        │
└────────────────────────────────┘
```

### 具体例

**例1: P002行の詳細情報を確認**
1. テーブルの P002 行をダブルクリック
2. 詳細ウィンドウが開く
3. その部品の全ての情報が表示される
4. 「閉じる」ボタンをクリックでウィンドウを閉じる

**例2: 複数の部品を比較したい**
1. P001 行をダブルクリック → ウィンドウA が開く
2. 元のテーブルで P003 行をダブルクリック → ウィンドウB が開く
3. 2つのウィンドウを並べて、複数部品を比較

**例3: 部品情報をスクリーンショット**
1. 詳細ウィンドウを開く
2. スクロールして全情報を確認
3. Print Screen キーで画像としてキャプチャ
4. 報告資料に貼り付け

### 詳細ウィンドウの特徴

| 特徴 | 説明 |
|------|------|
| **カテゴリ分け** | 4つのセクション（基本情報、車両情報、在庫・品質、その他）に整理 |
| **見やすいレイアウト** | 項目名は太字、値は左寄せで配置 |
| **スクロール対応** | 項目が多い場合は スクロールバー が自動表示 |
| **独立したウィンドウ** | メインウィンドウを操作しながら詳細を確認可能 |
| **金額フォーマット** | ¥マーク付きで金額を表示 |

### 技術情報
- **ウィンドウサイズ**: 600 x 800 ピクセル（縦横比 3:4）
- **レイアウト**: LabelFrame でカテゴリ分け
- **スクロール**: Canvas ベースで実装
- **実装メソッド**: `_show_detail_dialog()`, `_on_row_double_click()`

---

## 機能5: ポップアップUIの視認性最適化

### 概要
詳細情報を表示するポップアップウィンドウのデザインが大幅に改善されました。情報がカテゴリ別にグループ化され、項目名と値が明確に区別され、非常に読みやすくなっています。

### 設計のこだわり

#### 1. 最適なウィンドウサイズ
```
┌────────────────┐
│                │ 高さ: 800px
│    情報表示     │
│                │
│                │ 幅: 600px
│                │
└────────────────┘

縦横比 = 600:800 = 3:4
タブレットと同じ比率で、見やすい！
```

#### 2. カテゴリ別グループ化
情報が4つのセクションに整理されているので、見たい情報がすぐに見つかります。

```
┌────────────────────────────┐
│ [基本情報] セクション      │
│ ・部品管理番号             │
│ ・部品名                   │
│ ・金額                     │
├────────────────────────────┤
│ [車両情報] セクション      │
│ ・車名                     │
│ ・略式型式                 │
│ ・車体カラー               │
│ ・年式                     │
│ ・エンジン型式             │
├────────────────────────────┤
│ [在庫・品質情報] セクション│
│ ・在庫ステータス           │
│ ・品質区分                 │
│ ・保管場所                 │
├────────────────────────────┤
│ [その他情報] セクション    │
│ ・部品コード               │
│ ・メーカー                 │
│ ・登録日                   │
└────────────────────────────┘
```

#### 3. 視認性の工夫

| 工夫 | 効果 |
|------|------|
| **項目名を太字** | 項目名と値の区別が一目瞭然 |
| **左寄せ配置** | 読みやすい配置（左から右へ自然に読める） |
| **間隔の調整** | セクション間に適度な隙間で、情報が整理されて見える |
| **金額に¥マーク** | 「180000」ではなく「¥180,000」で数値が認識しやすい |
| **グレーの項目名** | 値との視覚的な区別がはっきり |

#### 4. スクロール機能
項目数が多い場合でもスクロールできるので、全情報を確認可能です。

```
┌──────────────────┐
│  部品詳細情報    │
├──────────────────┤
│ ┌──────────────┐ │
│ │ [基本情報]   │ │
│ │ 項目1: 値1   │ │
│ │ 項目2: 値2   │ │
│ │              │ │
│ │ [車両情報]   │▲│
│ │ 項目3: 値3   │ │  スクロール
│ │ ...         │ │  バー
│ │              │ │
│ │ [在庫情報]   │▼│
│ │ 項目N: 値N   │ │
│ └──────────────┘ │
└──────────────────┘
```

### 使用例

```
ウィンドウが表示されると、こんな感じで見えます：

┌───────────────────────────────────┐
│          部品詳細情報              │
├───────────────────────────────────┤
│ 基本情報                          │
├───────────────────────────────────┤
│ 部品管理番号:       P001          │
│ 部品名:            高速ベアリング   │
│ ﾈｯﾄ価格:           ¥250,000       │
│                                   │
│ 車両情報                          │
├───────────────────────────────────┤
│ 車名:            トヨタ アリオン  │
│ 略式型式:        AZT240          │
│ 車体カラー名称:  パール           │
│ 年式:            2020            │
│ エンジン型式:    4A-FE            │
│                                   │
│ 在庫・品質情報                    │
├───────────────────────────────────┤
│ 在庫ステータス:  在庫あり         │
│ 品質区分:        新品             │
│ 保管場所:        A棟1階           │
│                                   │
│ その他情報                        │
├───────────────────────────────────┤
│ 部品コード:      AT1-001          │
│ メーカー:        トヨタ自動車     │
│ 登録日:          2025-01-15       │
│                                   │
│                  [閉じる]          │
└───────────────────────────────────┘
```

### 技術情報
- **ウィンドウ種類**: tk.Toplevel（独立したウィンドウ）
- **レイアウト**: ttk.LabelFrame でセクション分け
- **スクロール**: tk.Canvas + ttk.Scrollbar
- **縦横比**: 3:4 (600x800px)

---

## まとめ表

| 機能 | 主な効果 | 使う頻度 |
|------|---------|---------|
| 曖昧検索 | 型式から部品を素早く検索 | 毎日 |
| 件数制限 | 高額部品トップN件を確認 | 週数回 |
| ソート機能 | 様々な角度からデータを分析 | 毎日 |
| 詳細表示 | 部品の全情報を確認 | 毎日 |
| UI最適化 | 詳細情報が見やすく、効率アップ | 毎日 |

---

## トラブルシューティング

### Q: 検索しても部品が見つかりません
**A:** 以下を確認してください：
- 検索テキストが正確か確認（スペース、記号の有無など）
- 大文字小文字は区別されません（OK）
- 空欄で検索するとフィルタが解除されます

### Q: 件数制限がうまく機能しません
**A:** 以下を確認してください：
- 「上位N件のみ表示」チェックボックスにチェックが入っているか
- 件数欄に数値が正しく入力されているか（0～9などの無効値がないか）
- 「フィルタ適用」ボタンを押し忘れていないか

### Q: ソートできません
**A:** 以下を確認してください：
- 列ヘッダーをクリックしているか（データ部分ではなく）
- データが読み込まれているか（テーブルが空ではないか）

### Q: 詳細ウィンドウが開きません
**A:** 以下を確認してください：
- テーブルの**行**をダブルクリックしているか（セル単位ではなく）
- データが読み込まれているか

### Q: 詳細ウィンドウが小さすぎます
**A:** ウィンドウをドラッグで拡大できます。ただし、デザイン上は600x800が最適です。

---

## 次のステップ

5つの新機能を活用して、作業を効率化してください：

1. **毎日の業務**: 曖昧検索とソート機能で素早くデータ分析
2. **定期報告**: 件数制限機能で「トップ10」を素早く確認
3. **詳細確認**: ダブルクリック詳細表示で全情報を一目で確認
4. **データ管理**: CSVエクスポートで外部ツールに連携

ご質問やご不明な点があれば、[USER_GUIDE.md](USER_GUIDE.md) の FAQ セクションをご覧ください。
