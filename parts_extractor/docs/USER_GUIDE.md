# ユーザーガイド - 操作方法・FAQ・トラブルシューティング

このガイドは、高額部品抽出ツール v2.0.0 の操作方法を分かりやすく説明します。

---

## 目次

1. [初期設定](#初期設定)
2. [基本操作](#基本操作)
3. [新機能の使い方](#新機能の使い方)
4. [よくある質問（FAQ）](#よくある質問faq)
5. [トラブルシューティング](#トラブルシューティング)
6. [キーボード・マウス操作](#キーボードマウス操作)
7. [データのエクスポート](#データのエクスポート)

---

## 初期設定

### Google Sheets API の設定（初回のみ）

#### ステップ1: Google Cloud プロジェクトを作成

```
1. ブラウザで https://console.cloud.google.com/ を開く
2. 「プロジェクトを選択」をクリック
3. 「新しいプロジェクト」をクリック
4. プロジェクト名を入力（例: "高額部品抽出ツール"）
5. 「作成」をクリック
```

#### ステップ2: Google Sheets API を有効化

```
1. Cloud Console の左メニューから「APIs と サービス」をクリック
2. 「ライブラリ」をクリック
3. 「Google Sheets API」を検索
4. 「Google Sheets API」をクリック
5. 「有効にする」をクリック
```

#### ステップ3: サービスアカウントを作成

```
1. 「APIs と サービス」から「認証情報」をクリック
2. 「認証情報を作成」 → 「サービスアカウント」をクリック
3. サービスアカウント名を入力
4. 「作成して続行」をクリック
5. ロール: 「Editor」を選択
6. 「続行」をクリック
```

#### ステップ4: JSON キーを生成

```
1. 「認証情報」ページでサービスアカウントをクリック
2. 「キー」タブをクリック
3. 「キーを追加」 → 「新しいキー」をクリック
4. キーのタイプで「JSON」を選択
5. 「作成」をクリック
6. JSON ファイルが自動ダウンロードされる
```

#### ステップ5: JSON ファイルをアプリケーションに配置

```
1. ダウンロードされた JSON ファイルを確認（デフォルトは Downloads フォルダ）
2. ファイルを parts_extractor フォルダにコピー
3. ファイル名を credentials.json に変更
```

> **セキュリティ警告**: credentials.json は機密ファイルです。絶対に他の人に見せたり、Git や クラウドに上げたりしないでください。

#### ステップ6: スプレッドシートにアクセス権を付与

```
1. Google Sheets でアクセスしたいスプレッドシートを開く
2. 右上の「共有」ボタンをクリック
3. サービスアカウントのメールアドレスを入力
   （JSON ファイルの "client_email" の値）
4. 権限は「閲覧者」を選択
5. 「共有」をクリック
```

---

## 基本操作

### アプリケーションの起動

#### Windows EXE から起動（推奨）

```
1. parts_extractor.exe ファイルをダブルクリック
2. ウィンドウが開く
3. 数秒で「準備完了」メッセージが表示される
```

#### Python から起動

```bash
# コマンドプロンプトを開く
cd C:\path\to\parts_extractor
python main.py
```

### ウィンドウレイアウト

```
┌─────────────────────────────────────────────┐
│  高額部品抽出ツール                         │
├─────────────────────────────────────────────┤
│ 【設定パネル】                              │
│  スプレッドシートID: [________] (URLから取得)│
│  シート名: [ドロップダウン] [シート更新]      │
│  最低金額（円）: [100000] ※この金額以上    │
│  略式型式で検索: [________] ※部分一致      │
│  [X] 上位N件のみ表示 [10] 件               │
├─────────────────────────────────────────────┤
│ 【ボタンパネル】                            │
│ [データ取得] [CSVエクスポート] [JSON保存]    │
│ [シート一覧更新] [フィルタ適用]             │
├─────────────────────────────────────────────┤
│ 【結果テーブル】                            │
│ 部品管理番号▲│部品名│金額│... (スクロール可)|
│ P001        │名前1│値1│...              │
│ P002        │名前2│値2│...              │
│ P003        │名前3│値3│...              │
│ ...                                      │
│ (右側にスクロールバー、下側にスクロールバー) │
├─────────────────────────────────────────────┤
│ 【ステータスバー】                          │
│ ステータス: [準備完了。Google Sheets使用中]│
│ フィルタ条件 - 最低金額: ¥100,000        │
└─────────────────────────────────────────────┘
```

---

## 基本操作ステップバイステップ

### 1: スプレッドシートを指定

```
Step 1: スプレッドシートID を入力
├─ Google Sheets を開く
├─ URL をコピー
│  例: https://docs.google.com/spreadsheets/d/【ここがID】/edit
├─ ツール画面の「スプレッドシートID」欄に貼り付け
└─ 例: 1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p

Step 2: シートを選択
├─ 「シート一覧更新」をクリック
├─ ドロップダウンにシート名が表示される
└─ 使用したいシートを選択
```

### 2: データを取得

```
Step 1: 最低金額を設定
├─ 「最低金額（円）」欄に金額を入力
├─ 例: 100000 （¥100,000以上の部品を取得）
└─ 留意: 数値のみ入力（カンマは不要）

Step 2: オプション設定（必要に応じて）
├─ 「略式型式で検索」に検索テキストを入力（オプション）
├─ 「上位N件のみ表示」をチェック（オプション）
└─ 「件数」を変更（デフォルト: 10）

Step 3: データを取得
├─ 「データ取得」をクリック
├─ ステータスバーが「～件の部品を表示」に変わる
└─ テーブルにデータが表示される
```

### 3: 結果を確認・フィルタリング

```
Step 1: データを並び替え
├─ 「金額」列ヘッダーをクリック
│  → 金額で昇順ソート（▲表示）
├─ もう一度クリック
│  → 降順に切り替え（▼表示）
└─ 別の列をクリック → その列でソート開始

Step 2: 1つの部品を詳しく確認
├─ テーブルの行をダブルクリック
├─ 詳細ウィンドウが開く
└─ 「閉じる」ボタンで閉じる

Step 3: フィルタを再度適用
├─ 検索条件を変更
├─ 「フィルタ適用」をクリック
└─ テーブルが更新される
```

### 4: 結果をエクスポート

```
Step 1: CSV に保存
├─ 「CSVエクスポート」をクリック
├─ 「エクスポート成功」メッセージが表示される
├─ exports フォルダにファイルが保存される
└─ 例: exports/部品エクスポート_20260128_210000.csv

Step 2: JSON に保存
├─ 「JSON保存」をクリック
└─ memory フォルダに JSON ファイルが保存される
```

---

## 新機能の使い方

### 機能1: 略式型式で曖昧検索

```
【基本操作】
1. 「略式型式で検索」欄に検索テキストを入力
   例: "AZT240"

2. 「フィルタ適用」をクリック

3. 検索テキストを含む行のみが表示される

【実際の例】
┌──────────────────────────────────┐
│ 略式型式で検索: [AZT]             │  < AZT と入力
│ [フィルタ適用]                   │
└──────────────────────────────────┘
                ↓
結果: short_model列に「AZT」を含む全行が表示される
      AZT240, AZT241, AZT242 など
```

### 機能2: 件数制限

```
【基本操作】
1. 「上位N件のみ表示」をチェック
2. 「件数」欄に数値を入力（1～1000）
3. 「フィルタ適用」をクリック
4. 指定件数だけが表示される

【例1: トップ10を見る】
┌──────────────────────────────────┐
│ [X] 上位N件のみ表示 [10] 件       │  < チェック + 10件
│ [フィルタ適用]                   │
└──────────────────────────────────┘
結果: 最高額から10件のみ表示

【例2: トップ5を見る】
┌──────────────────────────────────┐
│ [X] 上位N件のみ表示 [5] 件        │  < チェック + 5件
│ [フィルタ適用]                   │
└──────────────────────────────────┘
結果: 最高額から5件のみ表示

【例3: 全件を見る】
┌──────────────────────────────────┐
│ [ ] 上位N件のみ表示 [10] 件       │  < チェック外す
│ [フィルタ適用]                   │
└──────────────────────────────────┘
結果: チェックがOFFなので全件表示
```

### 機能3: ソート

```
【基本操作】
1. テーブルの列ヘッダーをクリック
2. その列で昇順ソート（ヘッダーに▲表示）
3. もう一度クリック → 降順に切り替え（▼表示）

【視覚的なガイド】
クリック:  クリック:
┌─────┐  ┌─────┐  ┌─────┐
│金額 │  │金額▲│  │金額▼│
└─────┘  └─────┘  └─────┘
 (1回目)  (2回目)

1回目: 昇順ソート（小→大）
2回目: 降順ソート（大→小）
```

### 機能4: 詳細表示

```
【基本操作】
1. テーブルの行をダブルクリック
2. 詳細ウィンドウが開く
3. 全情報が見やすく表示される
4. スクロール可能（項目が多い場合）
5. 「閉じる」ボタンで閉じる

【重要な点】
- セル（データ）をクリックではなく、行全体をダブルクリック
- 同時に複数のウィンドウを開いて比較できます
```

### 機能5: UI最適化

```
詳細ウィンドウは自動的に最適化されています。

特徴:
- ウィンドウサイズ: 600 x 800px（タブレットと同じ比率）
- 4つのセクションにグループ化
- 項目名は太字、値は左寄せ
- 金額には¥マーク付き
- スクロール対応

ユーザー側での操作は不要です。
```

---

## よくある質問（FAQ）

### Q1: スプレッドシートIDはどこに?

**A:** Google Sheets のURLから取得できます。

```
URL: https://docs.google.com/spreadsheets/d/1a2b3c4d5e6f/edit

                      ここがID
                      ↓
スプレッドシートID: 1a2b3c4d5e6f
```

### Q2: シート一覧更新がうまくいきません

**A:** 以下を確認してください：
1. スプレッドシートIDが正しいか
2. サービスアカウントに共有権限があるか
3. インターネット接続があるか
4. 1回目のシート更新は時間がかかる場合があります（30秒程度）

### Q3: 検索しても部品が見つかりません

**A:** 以下を確認してください：
1. 「フィルタ適用」ボタンを押し忘れていないか
2. 検索テキストが正確か（スペースがないか、記号が正しいか）
3. そもそもその部品がスプレッドシートに存在するか
4. データを「データ取得」で読み込み直してみてください

### Q4: データを取得したのに表示されません

**A:** 以下を確認してください：
1. ステータスバーにエラーメッセージが出ていないか
2. 最低金額の設定が「0」や「999999999」などの極端な値になっていないか
3. スプレッドシートに「amount」列があるか
4. データを「データ取得」で再度読み込んでください

### Q5: 件数制限が機能しません

**A:** 以下を確認してください：
1. 「上位N件のみ表示」にチェックが入っているか
2. 件数が「1～1000」の範囲か
3. 「フィルタ適用」ボタンを押したか
4. データが読み込まれているか（表示行数がある程度あるか）

### Q6: ソートができません

**A:** 以下を確認してください：
1. 列ヘッダー（データではなく、見出し行）をクリックしているか
2. クリック後にソートインジケータ（▲▼）が表示されるか
3. データが読み込まれているか（テーブルが空ではないか）
4. テーブルを 1 回クリックしてフォーカスを当ててから試してください

### Q7: 詳細ウィンドウが開きません

**A:** 以下を確認してください：
1. テーブルの行全体をダブルクリック（セル単位ではなく）
2. データが読み込まれているか
3. 行が選択されているか（ハイライト状態か）
4. 実行中のエラーメッセージがないか、ステータスバーを確認

### Q8: ウィンドウが大きすぎます/小さすぎます

**A:** ウィンドウをドラッグで拡大・縮小できます。ただし、デザイン上は 600x800 が最適です。

### Q9: CSVファイルがどこに保存されたか分かりません

**A:** 以下の場所を確認してください：
```
parts_extractor/exports/ フォルダ

例: C:\Users\YourName\Desktop\parts_extractor\exports\
    部品エクスポート_20260128_210000.csv
```

### Q10: CSVファイルを Excelで開くと日本語が文字化けします

**A:** 以下の方法で解決します：

**方法1: Excel の インポート機能を使用**
1. Excel を開く
2. 「ファイル」→「開く」
3. CSVファイルを選択
4. 「テキストインポートウィザード」が表示される
5. 文字コードを「UTF-8」に設定
6. 「完了」をクリック

**方法2: 別のアプリケーションを使用**
- Google Sheets: ファイル→インポート→CSV
- LibreOffice Calc: ファイル→開く（文字コード設定）

### Q11: 表示される行数がすごく多いです

**A:** 以下のいずれかの方法で件数を絞ってください：
1. 「上位N件のみ表示」でチェックして件数を制限
2. 「最低金額」をもっと高く設定
3. 「略式型式で検索」で検索条件を追加
4. 複数条件を組み合わせて「フィルタ適用」

### Q12: モックデータが表示されます

**A:** これは API 接続エラーです。以下を確認してください：
1. credentials.json ファイルが parts_extractor フォルダにあるか
2. Google Cloud プロジェクトで Google Sheets API が有効化されているか
3. インターネット接続があるか
4. スプレッドシートIDとシート名が正しいか
5. サービスアカウントに共有権限があるか

モックデータは「接続できない場合の代替表示」です。完全に正常ではない状態です。

### Q13: エラーメッセージが日本語です

**A:** エラーメッセージを注意深く読んでください。以下のような情報が含まれています：
- エラーの種類（認証失敗、ネットワークエラー等）
- 何が問題か
- どうすれば解決するか

ほとんどのメッセージは「どうするべきか」を説明しています。

### Q14: 複数のスプレッドシートを使用することはできますか?

**A:** はい、できます。スプレッドシートIDを変更して、「シート一覧更新」を押すだけです。

### Q15: 複数のシートを同時に比較できますか?

**A:** 不可です。1 度に 1 つのシートのみ表示できます。2 つのシートを比較したい場合：
1. ツールを 2 つ起動する
2. または、1 つ目をCSVにエクスポートしてから、2 つ目を開く

---

## トラブルシューティング

### 問題: 「スプレッドシートに接続できません」エラー

**原因**: API 認証失敗

**解決手順**:
```
1. credentials.json ファイルが parts_extractor フォルダにあるか確認
   → ない場合は、初期設定を見直す

2. Google Cloud Console にアクセス
   https://console.cloud.google.com/

3. Google Sheets API が有効化されているか確認
   → [APIs と サービス] → [ライブラリ]
   → Google Sheets API の横に「有効」と表示されているか

4. 該当のスプレッドシートにサービスアカウントが共有されているか確認
   → スプレッドシート → [共有]
   → サービスアカウントのメール（JSON の client_email）が登録されているか

5. インターネット接続を確認
   → ブラウザで Google.com にアクセスできるか試す
```

### 問題: 「シートが見つかりません」エラー

**原因**: シート名が間違っている、またはシートが存在しない

**解決手順**:
```
1. スプレッドシートをブラウザで開く
2. 左下のシートタブを確認
   → 見えているシート名をコピー

3. ツール画面でシート名を修正
   → 大文字小文字も区別されます

4. 「シート一覧更新」ボタンをクリック
   → ドロップダウンにシート名が表示される
```

### 問題: テーブルが空で、データが表示されない

**原因**: データ取得に失敗、またはフィルタが厳しすぎる

**解決手順**:
```
1. ステータスバーを確認
   → エラーメッセージが出ていないか

2. スプレッドシートにデータがあるか確認
   → ブラウザで実際に開いて確認

3. 最低金額の設定を確認
   → 「100000」など、データが実際に存在する範囲か

4. 略式型式検索やその他のフィルタが有効になっていないか確認
   → 不要なフィルタを解除

5. 「データ取得」を再度クリック
```

### 問題: ソート中にエラーが出た

**原因**: データ型が混在している、または無効なデータ

**解決手順**:
```
1. 金額列に不正な値がないか確認
   → 数値のみが入っていることを確認

2. テーブルを一度クリアして再度「データ取得」
```

### 問題: CSVエクスポート時に失敗

**原因**: ファイル書き込み権限がない、またはディスク容量不足

**解決手順**:
```
1. parts_extractor フォルダに書き込み権限があるか確認
   → フォルダを右クリック → プロパティ → セキュリティ

2. ディスク容量を確認
   → Cドライブの空き容量を確認（最低 100MB 推奨）

3. exports フォルダが存在するか確認
   → ない場合は、ツールが自動作成します

4. 既存のCSVファイルが開かれていないか確認
   → Excel等で開いているファイルは上書きできません
```

### 問題: アプリケーション自体が起動しない

**原因**: Python がインストールされていない、または依存パッケージがない

**解決手順**:
```
【EXEの場合】
1. 管理者権限で実行を試す
   → parts_extractor.exe を右クリック
   → [管理者として実行]

2. Windows Defender がブロックしていないか確認
   → セキュリティソフトの例外設定に追加

【Pythonから実行の場合】
1. Python 3.8 以上がインストールされているか確認
   コマンドプロンプトで:
   python --version

2. 依存パッケージをインストール
   cd C:\path\to\parts_extractor
   pip install -r requirements.txt

3. アプリケーションを起動
   python main.py
```

---

## キーボード・マウス操作

### マウス操作

| 操作 | 説明 |
|------|------|
| クリック | ボタンを押す、入力欄に文字を入力 |
| ダブルクリック | テーブルの行をダブルクリック → 詳細ウィンドウを開く |
| 右クリック | テーブルの行を右クリック → コンテキストメニュー（実装予定） |
| スクロール | マウスホイール → テーブルやウィンドウをスクロール |
| ドラッグ | ウィンドウの境界をドラッグ → ウィンドウをリサイズ |

### キーボード操作

| キー | 機能 |
|------|------|
| Tab | 入力欄間を移動 |
| Enter | 「データ取得」ボタン等を実行（ボタンがフォーカスされている場合） |
| Ctrl+C | テーブルの行をコピー（実装予定） |
| Ctrl+A | 全行を選択（実装予定） |
| Esc | 詳細ウィンドウを閉じる |

---

## データのエクスポート

### CSV形式でエクスポート

```
【操作】
1. 表示されているデータを確認
2. 「CSVエクスポート」ボタンをクリック
3. 「エクスポート成功」メッセージが表示される

【ファイル情報】
保存場所: parts_extractor/exports/
ファイル名: 部品エクスポート_年月日_時分秒.csv
例: 部品エクスポート_20260128_210000.csv

【ファイル特性】
- Excel で開いて編集可能
- UTF-8 BOM 付き（日本語OK）
- CSV形式（カンマ区切り）
- タイムスタンプ付きで、複数回エクスポートしても上書きされない
```

### JSON形式で保存

```
【操作】
1. 表示されているデータを確認
2. 「JSON保存」ボタンをクリック
3. メッセージが表示される

【ファイル情報】
保存場所: memory/
用途: データのバックアップ、プログラム間のデータ連携
```

### データの複製・再利用

```
【CSV → Google Sheets へ インポート】
1. Google Sheets を開く
2. 新しいスプレッドシートを作成
3. 「ファイル」 → 「インポート」
4. CSVファイルを選択
5. 「新しいシートに追加」を選択
6. 「インポート」をクリック

【CSV → Excel】
1. Excel を開く
2. 「ファイル」 → 「開く」
3. CSVファイルを選択
4. 「テキストインポートウィザード」で文字コード「UTF-8」を選択
5. インポート完了
```

---

## トラブルシューティング フローチャート

```
問題が発生した
   ↓
ステータスバーにエラーメッセージはありますか?
   ├─ はい → エラーメッセージを読んで対応
   └─ いいえ ↓
      データは表示されていますか?
      ├─ はい → 動作は進んでいるが、期待と異なる
      │        （FAQ を確認）
      └─ いいえ ↓
         スプレッドシートID は正しいですか?
         ├─ いいえ → 正しいID を入力して「データ取得」
         └─ はい ↓
            シート名は正しいですか?
            ├─ いいえ → 「シート一覧更新」で正しい名前を選択
            └─ はい ↓
               インターネット接続はありますか?
               ├─ いいえ → 接続を確認
               └─ はい ↓
                  Google Cloud の設定は完了していますか?
                  └─ いいえ → 初期設定セクションを参照
```

---

## 連絡先・サポート

問題が解決しない場合：

1. このガイドの「FAQ」を再度確認
2. 「トラブルシューティング」を実施
3. ログファイルを確認（`memory/` フォルダ）
4. システム管理者に相談

---

## 最後に

このツールを活用して、効率的に高額部品を管理してください。

**主な使用シーン:**
- 毎日の高額部品確認
- 報告資料の「トップ10」作成
- 部品情報の詳細確認
- 車型式ごとの部品分析

ご質問や機能リクエストがあれば、お知らせください。
