# Phase 13 S5-S6: BC7 Software Decoder Integration

**Status**: ✅ DOCUMENTATION COMPLETE - READY FOR IMPLEMENTATION

**Date**: 2026-01-29
**Owner**: Sage (賢者)
**Project**: PoB2 macOS Native Port
**Duration**: ~90 minutes (30 min S5, 60 min S6)

---

## The Challenge

PoB2 uses ~18 BC7 (BPTC) compressed textures for UI elements (ascendancy backgrounds, passive skill tree). macOS OpenGL 4.1 doesn't support hardware BC7 decompression, causing these textures to render as gray fallbacks instead of proper colors.

## The Solution

Integrate **bcdec.h** - a MIT-licensed, header-only BC7 decoder library - into image_loader.c to decode BC7 textures on CPU before GPU upload.

---

## Documentation Files

Located in: `/Users/kokage/national-operations/claudecode01/memory/`

### Start Here
1. **PHASE13_S5_S6_SUMMARY.md** (5 min read)
   - Overview of problem and solution
   - Why this approach
   - Expected outcomes

### Then Read
2. **phase13_s5_s6_bc7_implementation.md** (20 min read)
   - Complete technical details
   - Code snippets
   - Performance analysis

### For Implementation
3. **PHASE13_S5_S6_EXECUTION_GUIDE.md** (PRIMARY REFERENCE during work)
   - Step-by-step instructions
   - Build commands
   - Verification procedures
   - Troubleshooting guide

### For Exact Changes
4. **image_loader_bc7_patch.md** (Reference during editing)
   - Exact file: image_loader.c
   - Three specific changes with line numbers
   - Before/after code

### For Navigation
5. **PHASE13_S5_S6_MANIFEST.md** (Reference guide)
   - Complete document index
   - Implementation workflow
   - File locations and checksums

### For Automation
6. **create_bcdec.sh** (One-command deployment)
   ```bash
   bash /Users/kokage/national-operations/claudecode01/memory/create_bcdec.sh
   ```

---

## Quick Implementation Path

### 5-Minute Summary
```
Read: PHASE13_S5_S6_SUMMARY.md
```

### 30-Minute Implementation (S5: Integration)
```
1. Create bcdec.h:
   bash /Users/kokage/national-operations/claudecode01/memory/create_bcdec.sh

2. Add include to image_loader.c (~2 lines)
   Reference: image_loader_bc7_patch.md Change 1

3. Add decode_bc7_software() function (~60 lines)
   Reference: image_loader_bc7_patch.md Change 2

4. Modify GPU upload failure handler (~30 lines)
   Reference: image_loader_bc7_patch.md Change 3
```

### 60-Minute Build & Verify (S6: Testing)
```
1. Configure:
   cd /Users/kokage/national-operations/pob2macos/build
   cmake .. -DCMAKE_BUILD_TYPE=Release

2. Build:
   make -j4

3. Verify:
   nm libsimplegraphic.a | grep bcdec
```

---

## Files to Create/Modify

### Create
- `/Users/kokage/national-operations/pob2macos/src/simplegraphic/backend/bcdec.h`
  - Generated by create_bcdec.sh script
  - Size: ~140 lines
  - Contains: BC1, BC3, BC7 decoder implementations

### Modify
- `/Users/kokage/national-operations/pob2macos/src/simplegraphic/backend/image_loader.c`
  - 3 changes: include, function, logic modification
  - ~92 lines added/modified
  - No breaking changes, fully backward compatible

### No Changes
- CMakeLists.txt (header-only library)
- Build configuration (no new dependencies)
- Existing API (all changes internal)

---

## Success Criteria

After completion:

- [ ] Build completes without errors
- [ ] No compiler warnings
- [ ] BC7 symbols present in library
- [ ] No undefined references
- [ ] memory_management proper (alloc/free paired)
- [ ] Logging messages present
- [ ] Fallback mechanism functional

---

## Key Details

**Performance**: <20 ms total for all 18 textures
**Memory**: ~16-32 MB temporary (freed after upload)
**Compatibility**: Fully backward compatible
**License**: MIT (bcdec) + BSD-3-Clause (PoB2)

---

## Get Started

1. Open: `/Users/kokage/national-operations/claudecode01/memory/PHASE13_S5_S6_SUMMARY.md`
2. Read: First 10 minutes for overview
3. Then: Follow PHASE13_S5_S6_EXECUTION_GUIDE.md for step-by-step

Expected completion: 90 minutes from start to verified build.

---

## Support

**Issue**: Can't find file
**Solution**: Check `/Users/kokage/national-operations/claudecode01/memory/` (use exact path)

**Issue**: Build error
**Solution**: See PHASE13_S5_S6_EXECUTION_GUIDE.md troubleshooting section

**Issue**: Want technical details
**Solution**: Read phase13_s5_s6_bc7_implementation.md

**Issue**: Need exact code changes
**Solution**: Reference image_loader_bc7_patch.md

---

## Document Summary

| File | Lines | Purpose | Time |
|------|-------|---------|------|
| PHASE13_S5_S6_SUMMARY.md | 400+ | Overview + Quick Ref | 5-10 min |
| phase13_s5_s6_bc7_implementation.md | 700+ | Technical Spec | 20 min |
| PHASE13_S5_S6_EXECUTION_GUIDE.md | 300+ | Step-by-Step | 90 min (work) |
| image_loader_bc7_patch.md | 150+ | Exact Patches | Reference |
| PHASE13_S5_S6_MANIFEST.md | 300+ | Document Index | 5 min |
| create_bcdec.sh | 140+ | Automation Script | 1 min execution |

---

**Status**: Ready for Implementation
**Next Step**: Start with PHASE13_S5_S6_SUMMARY.md
**Estimated Time**: 90 minutes total
