# Plan: CalcSections セルテキストが見えない問題の修正

## 原因分析

### 症状
- Calcsタブでセルが「グレーで塗りつぶされて0が見えない」
- FormatStrエラーなし（diag_draw_errors.log未生成）
- CheckFlagは正常（Added Min等はブロックされていない）
- SetViewportバイパスでも改善なし

### 根本原因: sg_text.cpp のカラーテーブルが間違い

`sg_text.cpp:72-82` の色定義:
```cpp
static const float colors[10][3] = {
    {1.0f, 1.0f, 1.0f},  // ^0 White   ← 間違い（PoBでは黒）
    {1.0f, 0.0f, 0.0f},  // ^1 Red
    {0.0f, 1.0f, 0.0f},  // ^2 Green
    {0.0f, 0.0f, 1.0f},  // ^3 Blue
    {1.0f, 1.0f, 0.0f},  // ^4 Yellow
    {1.0f, 0.0f, 1.0f},  // ^5 Magenta
    {0.0f, 1.0f, 1.0f},  // ^6 Cyan
    {0.5f, 0.5f, 0.5f},  // ^7 Gray    ← 間違い（PoBでは白=デフォルトテキスト色）
    {1.0f, 0.5f, 0.0f},  // ^8 Orange
    {0.5f, 0.0f, 0.5f},  // ^9 Purple
};
```

**PoBの`^7`はデフォルトテキスト色 = 白**。コード全体で `"^7"..text` が標準パターン。
しかし我々の実装では `^7 = (0.5, 0.5, 0.5) = 暗いグレー`。

結果: 黒背景 (0,0,0) に暗いグレー (0.5,0.5,0.5) のテキスト → ほぼ見えない。

### 証拠
- ユーザー報告: 「グレーで塗りつぶされて0がみえない」→ テキスト色がグレー
- 他のUIで `^7` テキストも同じ問題（ただし明るい背景では見える）
- CalcSectionControl.lua:332: `"^7"..(fmtOk and fmtStr or "ERR")` → グレーで描画

## 修正案

### sg_text.cpp のカラーテーブルを正しいPoB標準色に修正

```cpp
static const float colors[10][3] = {
    {0.0f, 0.0f, 0.0f},  // ^0 Black (背景色)
    {1.0f, 0.0f, 0.0f},  // ^1 Red
    {0.0f, 1.0f, 0.0f},  // ^2 Green
    {0.0f, 0.0f, 1.0f},  // ^3 Blue
    {1.0f, 1.0f, 0.0f},  // ^4 Yellow
    {1.0f, 0.0f, 1.0f},  // ^5 Magenta
    {0.0f, 1.0f, 1.0f},  // ^6 Cyan
    {1.0f, 1.0f, 1.0f},  // ^7 White (デフォルトテキスト色)
    {0.75f, 0.75f, 0.75f},// ^8 Light Gray
    {0.6f, 0.6f, 0.6f},  // ^9 Dark Gray
};
```

### 追加: CalcSectionControl.lua のSetViewport元に戻す

診断用に外したSetViewportを元に戻す。

## 実装手順

1. sg_text.cpp のカラーテーブル修正（C++）
2. SimpleGraphicをリビルド
3. dylibをアプリバンドルにデプロイ
4. CalcSectionControl.lua のSetViewportを元に戻す
5. 視覚確認

## リスク・ロールバック

- **リスク**: Low — カラーテーブルの値変更のみ
- **影響範囲**: 全テキスト描画（^0-^9使用箇所すべて）→ むしろ全体的に改善
- **ロールバック**: カラーテーブルを元に戻すだけ

## 成功基準

1. Calcsタブのセル内テキスト（"0" 等）が**白色**で明確に見える
2. セクションヘッダー、ラベル、値すべてが適切な色で表示
3. 他のタブ（Tree, Skills等）のテキスト表示に悪影響なし

## 6点レビュー

1. ✅ 原因が明確: sg_text.cpp の ^7 が白ではなくグレーに設定されている
2. ✅ 技術的に妥当: カラーテーブルの定数値を修正するだけ
3. ✅ リスクが低い: 定数値の変更のみ、ロジック変更なし
4. ✅ ロールバック容易: 値を戻すだけ
5. ✅ 視覚確認計画あり: Calcsタブでセル値の視認性確認
6. ✅ タイムライン現実的: ビルド含め15分

**Score: 6/6 — 自動承認推奨**
