# テキストレンダリング修正計画 V5: 原点回帰

**日付**: 2026-02-02 18:40
**状態**: Phase 3 - 計画立案
**前回の試行**: V1-V4 すべて視覚的変化なし、または不完全

---

## V1-V4 調査の総括

### 実施した調査

**V1: Dirty Flag実装**
- 結果: 視覚的変化なし
- 学習: テクスチャ更新タイミングは問題ではない

**V2: 詳細ログ調査**
- 収集: 7,361行のログ
- 結果: グリフラスタライズ、テクスチャ更新すべて正常
- 学習: CPU層は問題なし

**V3: 頂点バッファ検証**
- 収集: 31MB、546,868 VERTEX-ADD
- 結果: 頂点データ、UV座標すべて正常
- 学習: GPU頂点層は問題なし

**V4: Fragment Shader デバッグ**
- 試行: Debug Modification A → A.1
- 結果: 視覚的変化なし（オレンジ/黄色のテキスト継続）
- 学習: Fragment Shaderデバッグが機能していない

### Progressive Elimination の結果

```
✅ CPU Layer (Lua DrawString, グリフラスタライズ, テクスチャ更新)
✅ GPU Vertex Layer (頂点バッファ, UV座標)
❌ GPU Fragment Layer (デバッグ失敗)
```

---

## 重大な気づき: V4の根本的な問題

### なぜFragment Shaderのデバッグが機能しなかったか？

**仮説: visual_test.lua が実際のアプリとは異なるコードパスを使用**

**証拠**:
1. visual_test.lua は簡素なテストプログラム
2. 実際のアプリ（PathOfBuilding.app）とは異なる可能性
3. V2-V3のログは visual_test.lua から収集
4. しかし、元の問題はPathOfBuilding.appで発生

**決定的な欠陥**: visual_test.lua でデバッグしても、実際のアプリの問題は解決しない可能性

---

## V5: 原点回帰アプローチ

### 戦略: 実際のアプリで直接テスト

**重要な認識**:
- visual_test.lua ではなく、**PathOfBuilding.app** を起動
- 実際の問題（パッシブツリー非表示）を直接観察
- 実際のアプリで視覚的検証

### 元の問題の再確認

**ユーザーの報告**（2026-02-01以前）:
- パッシブツリーが表示されない
- テキストが一部しか表示されない
- 画像（ring.png）が表示されない

**今までの調査**:
- すべて visual_test.lua で実施
- 実際のアプリ（PathOfBuilding.app）では未検証

---

## V5 実装プラン

### ステップ1: PathOfBuilding.app を起動

**Paladin タスク**:
1. PathOfBuilding.app を起動
2. Tree タブを開く
3. スクリーンショット撮影
4. 視覚的結果を報告

**期待される観察**:
- パッシブツリーが表示されるか？
- テキストが表示されるか？
- どの部分が表示され、どの部分が表示されないか？

**タイムボックス**: 5分

---

### ステップ2: 実際の問題を特定

**Sage タスク**:
スクリーンショットを分析し、以下を特定:
1. 何が表示されているか
2. 何が表示されていないか
3. visual_test.lua の問題と同じか、異なるか

**タイムボックス**: 5分

---

### ステップ3: 適切な修正方針を決定

**Mayor タスク**:
実際の問題に基づいて、次の方針を決定:

**ケースA: visual_test.lua と同じ問題**
- V1-V4の調査結果を活用
- Fragment Shader以外のアプローチを検討

**ケースB: 異なる問題**
- 新しい根本原因分析が必要
- 実際のアプリ固有の問題を調査

**ケースC: 問題が解決している**
- V1-V4のいずれかの修正が効果を発揮
- どの修正が有効だったか特定

**タイムボックス**: 10分

---

## なぜこのアプローチが必要か

### V1-V4の共通の欠陥

**すべて visual_test.lua で検証**:
- visual_test.lua は簡素なテストプログラム
- 実際のアプリ（PathOfBuilding.app）とは異なる
- 元の問題は PathOfBuilding.app で発生

**Occam's Razor（オッカムの剃刀）**:
- 最もシンプルな説明: visual_test.lua と PathOfBuilding.app は異なるコードパスを使用
- V1-V4の修正は visual_test.lua には効果がなかったが、実際のアプリには効果があるかもしれない

---

## タイムライン

- ステップ1: PathOfBuilding.app 起動・観察（5分）
- ステップ2: 実際の問題特定（5分）
- ステップ3: 修正方針決定（10分）
- **合計: 約20分**

---

## リスク評価

### リスク1: 問題が解決していない

**影響**: MEDIUM
**対策**: 実際の問題を観察し、新しいアプローチを立案

### リスク2: 新しい問題が発見される

**影響**: MEDIUM
**対策**: 実際の問題に基づいて V6 計画を立案

### リスク3: PathOfBuilding.app が起動しない

**影響**: LOW
**対策**: エラーログを確認、ビルド・デプロイを再実行

---

## 成功基準

### V5 成功基準

1. ✅ PathOfBuilding.app を起動し、Tree タブを開く
2. ✅ 実際の視覚的結果をスクリーンショットで記録
3. ✅ visual_test.lua との違いを特定
4. ✅ 次の修正方針を決定

### 最終成功基準

1. ✅ パッシブツリーが正しく表示される
2. ✅ すべてのテキストが正しく表示される
3. ✅ 画像が正しく表示される
4. ✅ ユーザー確認済み

---

## CRITICAL LESSONS の適用

### ルール1: ログは参考、視覚的結果が真実

**適用**: PathOfBuilding.app の視覚的結果を直接確認

### ルール3: Occam's Razor - 最もシンプルな説明

**適用**: visual_test.lua ではなく、実際のアプリをテスト

### ルール6: 知るべき時にリセット

**適用**: V1-V4 が行き詰まった → 原点回帰、実際のアプリを確認

---

**状態**: Phase 3 完了 - Phase 4（レビュー）に進む
